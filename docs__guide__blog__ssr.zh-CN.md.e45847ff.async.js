(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{BFcb:function(e,t,n){"use strict";n.r(t);var a=n("3Nsx"),c=n.n(a),o=n("C8qh"),l=n("sBO+"),r=c.a.memo((e=>{e.demos;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"markdown"},c.a.createElement("h1",{id:"react-hooks--ssr"},c.a.createElement(o["AnchorLink"],{to:"#react-hooks--ssr","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"React Hooks & SSR"),c.a.createElement("p",null,"\u670d\u52a1\u7aef\u6e32\u67d3\uff08Server-Side Rendering\uff09\uff0c\u662f\u6307\u7531\u670d\u52a1\u4fa7\u5b8c\u6210\u9875\u9762\u7684 HTML \u7ed3\u6784\u62fc\u63a5\u7684\u9875\u9762\u5904\u7406\u6280\u672f\u3002\u4e00\u822c\u7528\u4e8e\u89e3\u51b3 SEO \u95ee\u9898\u548c\u9996\u5c4f\u52a0\u8f7d\u901f\u5ea6\u95ee\u9898\u3002"),c.a.createElement("p",null,"\u7531\u4e8e SSR \u662f\u5728\u975e\u6d4f\u89c8\u5668\u73af\u5883\u6267\u884c JS \u4ee3\u7801\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u5f88\u591a\u95ee\u9898\u3002\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd React Hooks \u5728 SSR \u6a21\u5f0f\u4e0b\u5e38\u89c1\u95ee\u9898\u53ca\u89e3\u51b3\u65b9\u6848\u3002"),c.a.createElement("blockquote",null,c.a.createElement("p",null,"\u66f4\u591a\u5173\u4e8e SSR \u7684\u4ecb\u7ecd\u53ef\u4ee5\u770b UmiJS \u7684\u6587\u6863\u300a",c.a.createElement(o["Link"],{to:"https://umijs.org/zh-CN/docs/ssr#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%EF%BC%88ssr%EF%BC%89"},"\u670d\u52a1\u7aef\u6e32\u67d3\uff08SSR\uff09"),"\u300b\u3002")),c.a.createElement("h2",{id:"\u95ee\u9898\u4e00dombom-\u7f3a\u5931"},c.a.createElement(o["AnchorLink"],{to:"#\u95ee\u9898\u4e00dombom-\u7f3a\u5931","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u95ee\u9898\u4e00\uff1aDOM/BOM \u7f3a\u5931"),c.a.createElement("p",null,"SSR \u662f\u5728 node \u73af\u5883\u4e0b\u8fd0\u884c React \u4ee3\u7801\uff0c\u800c\u6b64\u65f6 window\u3001document\u3001navigator \u7b49\u5168\u5c40\u5c5e\u6027\u6ca1\u6709\u3002\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u4e86\u8fd9\u4e9b\u5c5e\u6027\uff0c\u5c31\u4f1a\u62a5\u9519 ",c.a.createElement("code",null,"window is not defined, document is not defined, navigator is not defined")," \u7b49\u3002"),c.a.createElement("p",null,"\u5e38\u89c1\u7684\u9519\u8bef\u7528\u6cd5\u662f\u5728 Hooks \u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u76f4\u63a5\u4f7f\u7528\u4e86 document \u7b49\u5168\u5c40\u5c5e\u6027\u3002"),c.a.createElement(l["a"],{code:"import React, { useState } from 'react';\n\nexport default () => {\n  const [state, setState] = useState(document.visibilityState);\n  return state;\n};",lang:"js"}),c.a.createElement("h3",{id:"\u89e3\u51b3\u65b9\u6848"},c.a.createElement(o["AnchorLink"],{to:"#\u89e3\u51b3\u65b9\u6848","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u89e3\u51b3\u65b9\u6848"),c.a.createElement("ol",null,c.a.createElement("li",null,"\u5c06\u8bbf\u95ee DOM/BOM \u7684\u65b9\u6cd5\u653e\u5728 useEffect/useLayoutEffect \u4e2d\uff08\u670d\u52a1\u7aef\u4e0d\u4f1a\u6267\u884c\uff09\uff0c\u907f\u514d\u670d\u52a1\u7aef\u6267\u884c\u65f6\u62a5\u9519\uff0c\u4f8b\u5982\uff1a")),c.a.createElement(l["a"],{code:"import React, { useState, useEffect } from 'react';\n\nexport default () => {\n  const [state, setState] = useState();\n\n  useEffect(() => {\n    setState(document.visibilityState);\n  }, []);\n\n  return state;\n};",lang:"js"}),c.a.createElement("ol",{start:2},c.a.createElement("li",null,"\u901a\u8fc7 ",c.a.createElement("code",null,"isBrowser")," \u6765\u505a\u73af\u5883\u5224\u65ad")),c.a.createElement(l["a"],{code:"import React, { useState } from 'react';\n\nfunction isBrowser() {\n  return !!(typeof window !== 'undefined' && window.document && window.document.createElement);\n}\n\nexport default () => {\n  const [state, setState] = useState(isBrowser() && document.visibilityState);\n\n  return state;\n};",lang:"js"}),c.a.createElement("h2",{id:"\u95ee\u9898\u4e8c-uselayouteffect-warning"},c.a.createElement(o["AnchorLink"],{to:"#\u95ee\u9898\u4e8c-uselayouteffect-warning","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u95ee\u9898\u4e8c useLayoutEffect Warning"),c.a.createElement("p",null,"\u5982\u679c\u4f7f\u7528\u4e86 ",c.a.createElement("code",null,"useLayoutEffect"),"\uff0c\u5728 SSR \u6a21\u5f0f\u4e0b\uff0c\u4f1a\u51fa\u73b0\u4ee5\u4e0b\u8b66\u544a"),c.a.createElement("blockquote",null,c.a.createElement("p",null,"\u26a0\ufe0f Warning: useLayoutEffect does nothing on the server, because its effect cannot be encoded into the server renderer's output format. This will lead to a mismatch between the initial, non-hydrated UI and the intended UI. To avoid this, useLayoutEffect should only be used in components that render exclusively on the client. See ",c.a.createElement(o["Link"],{to:"https://fb.me/react-uselayouteffect-ssr"},"https://fb.me/react-uselayouteffect-ssr")," for common fixes.")),c.a.createElement("h3",{id:"\u89e3\u51b3\u65b9\u6848-1"},c.a.createElement(o["AnchorLink"],{to:"#\u89e3\u51b3\u65b9\u6848-1","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u89e3\u51b3\u65b9\u6848"),c.a.createElement("ol",null,c.a.createElement("li",null,"\u4f7f\u7528 useEffect \u4ee3\u66ff useLayoutEffect\uff08\u5e9f\u8bdd\uff09"),c.a.createElement("li",null,"\u6839\u636e\u73af\u5883\u52a8\u6001\u7684\u6307\u5b9a\u662f\u4f7f\u7528 useEffect \u8fd8\u662f useLayoutEffect\u3002\u8fd9\u662f\u6765\u81ea\u793e\u533a\u7684\u4e00\u79cd hack \u89e3\u51b3\u65b9\u6848\uff0c\u76ee\u524d\u5728 ",c.a.createElement(o["Link"],{to:"https://github.com/reduxjs/react-redux/blob/d16262582b2eeb62c05313fca3eb59dc0b395955/src/components/connectAdvanced.js#L40"},"react-redux"),"\u3001",c.a.createElement(o["Link"],{to:"https://github.com/streamich/react-use/blob/master/src/useIsomorphicLayoutEffect.ts"},"react-use"),"\u3001",c.a.createElement(o["Link"],{to:"https://github.com/atlassian/react-beautiful-dnd/blob/master/src/view/use-isomorphic-layout-effect.js"},"react-beautiful-dnd")," \u5747\u4f7f\u7528\u7684\u8fd9\u79cd\u65b9\u6848\u3002")),c.a.createElement(l["a"],{code:"import { useLayoutEffect, useEffect } from 'react';\nconst useIsomorphicLayoutEffect = isBrowser() ? useLayoutEffect : useEffect;\nexport default useIsomorphicLayoutEffect;",lang:"js"}),c.a.createElement("h2",{id:"\u603b\u7ed3\u5199-hooks-\u65f6\u9700\u8981\u6ce8\u610f"},c.a.createElement(o["AnchorLink"],{to:"#\u603b\u7ed3\u5199-hooks-\u65f6\u9700\u8981\u6ce8\u610f","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u603b\u7ed3\uff1a\u5199 Hooks \u65f6\u9700\u8981\u6ce8\u610f"),c.a.createElement("ol",null,c.a.createElement("li",null,"\u4e0d\u8981\u5728\u975e useEffect/useLayoutEffect \u4e2d\uff0c\u76f4\u63a5\u4f7f\u7528 DOM/BOM \u5c5e\u6027"),c.a.createElement("li",null,"\u5728\u975e useEffect/useLayoutEffect \u4f7f\u7528 DOM/BOM \u5c5e\u6027\u65f6\uff0c\u4f7f\u7528 ",c.a.createElement("code",null,"isBrowser")," \u5224\u65ad\u662f\u5426\u5728\u6d4f\u89c8\u5668\u73af\u5883\u6267\u884c"),c.a.createElement("li",null,"\u5982\u679c\u67d0\u4e2a Hook \u9700\u8981\u63a5\u6536 DOM/BOM \u5c5e\u6027\uff0c\u9700\u8981\u652f\u6301\u51fd\u6570\u5f62\u5f0f\u4f20\u53c2\u3002\u4ee5 ahooks \u7684 useEventListener \u4e3e\u4f8b\uff0c\u5fc5\u987b\u652f\u6301\u51fd\u6570\u5f62\u5f0f\u6765\u6307\u5b9a target \u5c5e\u6027\u3002")),c.a.createElement(l["a"],{code:"import React, { useState } from 'react';\nimport { useEventListener } from 'ahooks';\n\nexport default () => {\n  const [value, setValue] = useState(0);\n\n  const clickHandler = () => {\n    setValue(value + 1);\n  };\n\n  useEventListener(\n    'click',\n    clickHandler,\n    {\n-       target: document.getElementById('click-btn')\n+       target: () => document.getElementById('click-btn')\n    }\n  );\n\n  return (\n    <button id=\"click-btn\" type=\"button\">\n      You click {value} times\n    </button>\n  );\n};",lang:"diff"}),c.a.createElement("ol",{start:4},c.a.createElement("li",null,"\u4f7f\u7528 ",c.a.createElement("code",null,"useIsomorphicLayoutEffect")," \u6765\u4ee3\u66ff ",c.a.createElement("code",null,"useLayoutEffect"))),c.a.createElement("h2",{id:"\u53c2\u8003\u8d44\u6599"},c.a.createElement(o["AnchorLink"],{to:"#\u53c2\u8003\u8d44\u6599","aria-hidden":"true",tabIndex:-1},c.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u8d44\u6599"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(o["Link"],{to:"https://github.com/alibaba/hooks/pull/935/files"},"fix: useDocumentVisiblility support ssr")),c.a.createElement("li",null,c.a.createElement(o["Link"],{to:"https://umijs.org/zh-CN/docs/ssr#window-is-not-defined-document-is-not-defined-navigator-is-not-defined"},"UmiJS \u670d\u52a1\u7aef\u6e32\u67d3")),c.a.createElement("li",null,c.a.createElement(o["Link"],{to:"https://medium.com/@alexandereardon/uselayouteffect-and-ssr-192986cdcf7a"},"useLayoutEffect and SSR")))))}));t["default"]=e=>{var t=c.a.useContext(o["context"]),n=t.demos;return c.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&o["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),c.a.createElement(r,{demos:n})}}}]);